{% extends 'billing/base_billing.html' %}
{% load static %}

{% block title %}¬°Pago Exitoso! - AgroTech Digital{% endblock %}

{% block extra_css %}
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUCCESS ‚Äî Apple Dark Style ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.success-container {
    text-align: center;
    padding: 100px 0 60px;
    max-width: 680px;
    margin: 0 auto;
}

/* Confetti canvas */
#confettiCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 9999;
}

/* Icon animation */
.success-icon {
    width: 96px;
    height: 96px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(52, 199, 89, 0.2), rgba(52, 199, 89, 0.05));
    border: 2px solid rgba(52, 199, 89, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 32px;
    animation: scaleIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.success-icon i {
    font-size: 44px;
    color: var(--verde-claro);
}

@keyframes scaleIn {
    0% { transform: scale(0); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

.success-container h1 {
    font-size: clamp(28px, 5vw, 44px);
    font-weight: 800;
    letter-spacing: -0.03em;
    color: var(--texto-claro);
    margin-bottom: 12px;
}

.success-container .subtitle {
    font-size: 17px;
    color: var(--gris-400);
    margin-bottom: 48px;
}

/* Details Card */
.details-card {
    background: var(--gris-950);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: var(--radius-xl);
    padding: 36px;
    text-align: left;
    margin-bottom: 32px;
}

.details-card h3 {
    font-size: 16px;
    font-weight: 700;
    color: var(--texto-claro);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.details-card h3 i {
    color: var(--verde-claro);
}

.detail-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    font-size: 14px;
}

.detail-row:last-child {
    border-bottom: none;
}

.detail-row .label {
    color: var(--gris-400);
}

.detail-row .value {
    color: var(--texto-claro);
    font-weight: 600;
}

.status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(52, 199, 89, 0.15);
    color: var(--verde-claro);
    padding: 4px 14px;
    border-radius: 980px;
    font-size: 13px;
    font-weight: 600;
}

.status-badge::before {
    content: '';
    width: 6px;
    height: 6px;
    background: var(--verde-claro);
    border-radius: 50%;
}

/* Next Steps */
.next-steps {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 40px;
}

.step-card {
    background: var(--gris-950);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 16px;
    padding: 24px 20px;
    text-align: center;
    transition: var(--transition-smooth);
}

.step-card:hover {
    border-color: rgba(255, 255, 255, 0.12);
    transform: translateY(-2px);
}

.step-num {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 12px;
    background: rgba(52, 199, 89, 0.12);
    border-radius: 10px;
    color: var(--verde-claro);
    font-size: 14px;
    font-weight: 800;
}

.step-card h4 {
    font-size: 14px;
    font-weight: 600;
    color: var(--texto-claro);
    margin-bottom: 6px;
}

.step-card p {
    font-size: 13px;
    color: var(--gris-400);
    margin: 0;
    line-height: 1.5;
}

/* CTA */
.btn-dashboard {
    display: inline-flex;
    align-items: center;
    gap: 10px;
    padding: 16px 40px;
    background: var(--verde-claro);
    color: #000;
    border: none;
    border-radius: 980px;
    font-size: 16px;
    font-weight: 700;
    font-family: 'Inter', sans-serif;
    cursor: pointer;
    transition: var(--transition-smooth);
    text-decoration: none;
}

.btn-dashboard:hover {
    background: var(--verde-accent);
    box-shadow: 0 8px 24px rgba(52, 199, 89, 0.3);
    transform: scale(1.02);
    color: #000;
}

.btn-secondary-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    margin-top: 16px;
    font-size: 14px;
    font-weight: 500;
    color: var(--gris-400);
    text-decoration: none;
    transition: var(--transition-smooth);
}

.btn-secondary-link:hover {
    color: var(--verde-claro);
}

/* Responsive */
@media (max-width: 640px) {
    .next-steps { grid-template-columns: 1fr; }
    .success-container { padding: 60px 0 40px; }
    .success-container h1 { font-size: 24px; }
    .success-container .subtitle { font-size: 14px; margin-bottom: 32px; }
    .details-card { padding: 24px; }
    .details-card h3 { font-size: 14px; }
    .detail-row { font-size: 13px; padding: 12px 0; flex-wrap: wrap; gap: 4px; }
    .detail-row .label { min-width: 100px; }
    .success-icon { width: 72px; height: 72px; margin-bottom: 24px; }
    .success-icon i { font-size: 32px; }
    .step-card { padding: 20px 16px; }
    .step-card h4 { font-size: 13px; }
    .step-card p { font-size: 12px; }
    .btn-dashboard { padding: 14px 32px; font-size: 14px; width: 100%; justify-content: center; }
}
</style>
{% endblock %}

{% block content %}
<canvas id="confettiCanvas"></canvas>

<div class="container">
    <div class="success-container">
        <!-- Icon -->
        <div class="success-icon">
            <i class="ti ti-circle-check"></i>
        </div>

        <h1>¬°Pago realizado con √©xito!</h1>
        <p class="subtitle">Bienvenido a AgroTech Digital Premium. Tu suscripci√≥n est√° activa.</p>

        <!-- Details -->
        <div class="details-card">
            <h3><i class="ti ti-receipt"></i> Detalles de tu suscripci√≥n</h3>
            <div class="detail-row">
                <span class="label">Plan</span>
                <span class="value" id="detailPlan">‚Äî</span>
            </div>
            <div class="detail-row">
                <span class="label">Ciclo</span>
                <span class="value" id="detailCycle">‚Äî</span>
            </div>
            <div class="detail-row">
                <span class="label">ID de suscripci√≥n</span>
                <span class="value" id="detailSubId">‚Äî</span>
            </div>
            <div class="detail-row">
                <span class="label">Estado</span>
                <span class="status-badge" id="detailStatus">Activo</span>
            </div>
        </div>

        <!-- Next Steps -->
        <h3 style="font-size: 20px; font-weight: 700; color: var(--texto-claro); margin-bottom: 20px;">Pr√≥ximos pasos</h3>
        <div class="next-steps">
            <div class="step-card">
                <div class="step-num">1</div>
                <h4>Configura tu finca</h4>
                <p>Agrega tus parcelas y define tus cultivos.</p>
            </div>
            <div class="step-card">
                <div class="step-num">2</div>
                <h4>An√°lisis Satelital</h4>
                <p>Ejecuta tu primer an√°lisis NDVI en segundos.</p>
            </div>
            <div class="step-card">
                <div class="step-num">3</div>
                <h4>Optimiza</h4>
                <p>Revisa los informes y mejora tu rendimiento.</p>
            </div>
        </div>

        <!-- CTA -->
        <a href="https://frontend-cliente-agrotech.netlify.app/templates/dashboard.html" class="btn-dashboard">
            <i class="ti ti-layout-dashboard"></i>
            Ir al Dashboard
        </a>
        <br>
        <a href="/billing/mi-suscripcion/" class="btn-secondary-link">
            <i class="ti ti-settings"></i> Ver mi suscripci√≥n
        </a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Parse URL params
    const params = new URLSearchParams(window.location.search);
    const planMap = {'basic': 'Agricultor', 'pro': 'Empresarial', 'free': 'Explorador'};
    const tier = params.get('plan') || 'basic';
    const cycle = params.get('cycle') || 'monthly';

    document.getElementById('detailPlan').textContent = planMap[tier] || tier;
    document.getElementById('detailCycle').textContent = cycle === 'yearly' ? 'Anual' : 'Mensual';
    document.getElementById('detailSubId').textContent = params.get('preapproval_id') || params.get('subscription_id') || '‚Äî';

    // Confetti üéâ
    const canvas = document.getElementById('confettiCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const colors = ['#34C759', '#30D158', '#007A20', '#FF9F0A', '#f5f5f7', '#86868b'];
    const particles = [];

    for (let i = 0; i < 150; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height - canvas.height,
            w: Math.random() * 10 + 4,
            h: Math.random() * 6 + 3,
            color: colors[Math.floor(Math.random() * colors.length)],
            speed: Math.random() * 3 + 2,
            angle: Math.random() * Math.PI * 2,
            spin: (Math.random() - 0.5) * 0.1,
            drift: (Math.random() - 0.5) * 1,
        });
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let alive = false;
        particles.forEach(p => {
            if (p.y < canvas.height + 20) alive = true;
            p.y += p.speed;
            p.x += p.drift;
            p.angle += p.spin;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.angle);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = Math.max(0, 1 - p.y / canvas.height);
            ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
            ctx.restore();
        });
        if (alive) requestAnimationFrame(animate);
        else canvas.remove();
    }
    animate();

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
});
</script>
{% endblock %}
